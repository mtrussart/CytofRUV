<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Introduction to CytofRUV</title>

<script>// Hide empty <a> tag within highlighted CodeBlock for screen reader accessibility (see https://github.com/jgm/pandoc/issues/6352#issuecomment-626106786) -->
// v0.0.1
// Written by JooYoung Seo (jooyoung@psu.edu) and Atsushi Yasumoto on June 1st, 2020.

document.addEventListener('DOMContentLoaded', function() {
  const codeList = document.getElementsByClassName("sourceCode");
  for (var i = 0; i < codeList.length; i++) {
    var linkList = codeList[i].getElementsByTagName('a');
    for (var j = 0; j < linkList.length; j++) {
      if (linkList[j].innerHTML === "") {
        linkList[j].setAttribute('aria-hidden', 'true');
      }
    }
  }
});
</script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Introduction to CytofRUV</h1>



<div id="introduction-to-cytofruv" class="section level1">
<h1>Introduction to CytofRUV</h1>
<p>CytofRUV is a computational algorithm which permits the integration of data across CyTOF batches. We provided an introduction here that explains step by step how to load and normalise datasets and also how to visualise the diagnostic plots using the R-Shiny application before and after CytofRUV normalisation.</p>
<div id="setup" class="section level2">
<h2>Setup</h2>
<p>We provided an example of a set of data that included all .fcs, a metadata file a and panel file in the inst/extdata. First of all we need to load all the packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(CytofRUV)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(CATALYST)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="co">#&gt; Loading required package: SingleCellExperiment</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co">#&gt; Loading required package: SummarizedExperiment</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co">#&gt; Loading required package: GenomicRanges</span></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#&gt; Loading required package: stats4</span></span>
<span id="cb1-7"><a href="#cb1-7"></a><span class="co">#&gt; Loading required package: BiocGenerics</span></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co">#&gt; Loading required package: parallel</span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#&gt; </span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co">#&gt; Attaching package: &#39;BiocGenerics&#39;</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#&gt; The following objects are masked from &#39;package:parallel&#39;:</span></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co">#&gt; </span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="co">#&gt;     clusterApply, clusterApplyLB, clusterCall, clusterEvalQ,</span></span>
<span id="cb1-14"><a href="#cb1-14"></a><span class="co">#&gt;     clusterExport, clusterMap, parApply, parCapply, parLapply,</span></span>
<span id="cb1-15"><a href="#cb1-15"></a><span class="co">#&gt;     parLapplyLB, parRapply, parSapply, parSapplyLB</span></span>
<span id="cb1-16"><a href="#cb1-16"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb1-17"><a href="#cb1-17"></a><span class="co">#&gt; </span></span>
<span id="cb1-18"><a href="#cb1-18"></a><span class="co">#&gt;     IQR, mad, sd, var, xtabs</span></span>
<span id="cb1-19"><a href="#cb1-19"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb1-20"><a href="#cb1-20"></a><span class="co">#&gt; </span></span>
<span id="cb1-21"><a href="#cb1-21"></a><span class="co">#&gt;     anyDuplicated, append, as.data.frame, basename, cbind, colnames,</span></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="co">#&gt;     dirname, do.call, duplicated, eval, evalq, Filter, Find, get, grep,</span></span>
<span id="cb1-23"><a href="#cb1-23"></a><span class="co">#&gt;     grepl, intersect, is.unsorted, lapply, Map, mapply, match, mget,</span></span>
<span id="cb1-24"><a href="#cb1-24"></a><span class="co">#&gt;     order, paste, pmax, pmax.int, pmin, pmin.int, Position, rank,</span></span>
<span id="cb1-25"><a href="#cb1-25"></a><span class="co">#&gt;     rbind, Reduce, rownames, sapply, setdiff, sort, table, tapply,</span></span>
<span id="cb1-26"><a href="#cb1-26"></a><span class="co">#&gt;     union, unique, unsplit, which, which.max, which.min</span></span>
<span id="cb1-27"><a href="#cb1-27"></a><span class="co">#&gt; Loading required package: S4Vectors</span></span>
<span id="cb1-28"><a href="#cb1-28"></a><span class="co">#&gt; </span></span>
<span id="cb1-29"><a href="#cb1-29"></a><span class="co">#&gt; Attaching package: &#39;S4Vectors&#39;</span></span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co">#&gt; </span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#&gt;     expand.grid</span></span>
<span id="cb1-33"><a href="#cb1-33"></a><span class="co">#&gt; Loading required package: IRanges</span></span>
<span id="cb1-34"><a href="#cb1-34"></a><span class="co">#&gt; Loading required package: GenomeInfoDb</span></span>
<span id="cb1-35"><a href="#cb1-35"></a><span class="co">#&gt; Loading required package: Biobase</span></span>
<span id="cb1-36"><a href="#cb1-36"></a><span class="co">#&gt; Welcome to Bioconductor</span></span>
<span id="cb1-37"><a href="#cb1-37"></a><span class="co">#&gt; </span></span>
<span id="cb1-38"><a href="#cb1-38"></a><span class="co">#&gt;     Vignettes contain introductory material; view with</span></span>
<span id="cb1-39"><a href="#cb1-39"></a><span class="co">#&gt;     &#39;browseVignettes()&#39;. To cite Bioconductor, see</span></span>
<span id="cb1-40"><a href="#cb1-40"></a><span class="co">#&gt;     &#39;citation(&quot;Biobase&quot;)&#39;, and for packages &#39;citation(&quot;pkgname&quot;)&#39;.</span></span>
<span id="cb1-41"><a href="#cb1-41"></a><span class="co">#&gt; Loading required package: DelayedArray</span></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="co">#&gt; Loading required package: matrixStats</span></span>
<span id="cb1-43"><a href="#cb1-43"></a><span class="co">#&gt; </span></span>
<span id="cb1-44"><a href="#cb1-44"></a><span class="co">#&gt; Attaching package: &#39;matrixStats&#39;</span></span>
<span id="cb1-45"><a href="#cb1-45"></a><span class="co">#&gt; The following objects are masked from &#39;package:Biobase&#39;:</span></span>
<span id="cb1-46"><a href="#cb1-46"></a><span class="co">#&gt; </span></span>
<span id="cb1-47"><a href="#cb1-47"></a><span class="co">#&gt;     anyMissing, rowMedians</span></span>
<span id="cb1-48"><a href="#cb1-48"></a><span class="co">#&gt; </span></span>
<span id="cb1-49"><a href="#cb1-49"></a><span class="co">#&gt; Attaching package: &#39;DelayedArray&#39;</span></span>
<span id="cb1-50"><a href="#cb1-50"></a><span class="co">#&gt; The following objects are masked from &#39;package:matrixStats&#39;:</span></span>
<span id="cb1-51"><a href="#cb1-51"></a><span class="co">#&gt; </span></span>
<span id="cb1-52"><a href="#cb1-52"></a><span class="co">#&gt;     colMaxs, colMins, colRanges, rowMaxs, rowMins, rowRanges</span></span>
<span id="cb1-53"><a href="#cb1-53"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb1-54"><a href="#cb1-54"></a><span class="co">#&gt; </span></span>
<span id="cb1-55"><a href="#cb1-55"></a><span class="co">#&gt;     aperm, apply, rowsum</span></span>
<span id="cb1-56"><a href="#cb1-56"></a><span class="kw">library</span>(flowCore)</span>
<span id="cb1-57"><a href="#cb1-57"></a><span class="co">#&gt; </span></span>
<span id="cb1-58"><a href="#cb1-58"></a><span class="co">#&gt; Attaching package: &#39;flowCore&#39;</span></span>
<span id="cb1-59"><a href="#cb1-59"></a><span class="co">#&gt; The following object is masked from &#39;package:BiocGenerics&#39;:</span></span>
<span id="cb1-60"><a href="#cb1-60"></a><span class="co">#&gt; </span></span>
<span id="cb1-61"><a href="#cb1-61"></a><span class="co">#&gt;     normalize</span></span>
<span id="cb1-62"><a href="#cb1-62"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb1-63"><a href="#cb1-63"></a><span class="kw">library</span>(readxl)</span>
<span id="cb1-64"><a href="#cb1-64"></a><span class="kw">library</span>(ruv)</span>
<span id="cb1-65"><a href="#cb1-65"></a><span class="kw">library</span>(purrr)</span>
<span id="cb1-66"><a href="#cb1-66"></a><span class="co">#&gt; </span></span>
<span id="cb1-67"><a href="#cb1-67"></a><span class="co">#&gt; Attaching package: &#39;purrr&#39;</span></span>
<span id="cb1-68"><a href="#cb1-68"></a><span class="co">#&gt; The following object is masked from &#39;package:DelayedArray&#39;:</span></span>
<span id="cb1-69"><a href="#cb1-69"></a><span class="co">#&gt; </span></span>
<span id="cb1-70"><a href="#cb1-70"></a><span class="co">#&gt;     simplify</span></span>
<span id="cb1-71"><a href="#cb1-71"></a><span class="co">#&gt; The following object is masked from &#39;package:GenomicRanges&#39;:</span></span>
<span id="cb1-72"><a href="#cb1-72"></a><span class="co">#&gt; </span></span>
<span id="cb1-73"><a href="#cb1-73"></a><span class="co">#&gt;     reduce</span></span>
<span id="cb1-74"><a href="#cb1-74"></a><span class="co">#&gt; The following object is masked from &#39;package:IRanges&#39;:</span></span>
<span id="cb1-75"><a href="#cb1-75"></a><span class="co">#&gt; </span></span>
<span id="cb1-76"><a href="#cb1-76"></a><span class="co">#&gt;     reduce</span></span>
<span id="cb1-77"><a href="#cb1-77"></a><span class="kw">library</span>(FlowSOM)</span>
<span id="cb1-78"><a href="#cb1-78"></a><span class="co">#&gt; Loading required package: igraph</span></span>
<span id="cb1-79"><a href="#cb1-79"></a><span class="co">#&gt; </span></span>
<span id="cb1-80"><a href="#cb1-80"></a><span class="co">#&gt; Attaching package: &#39;igraph&#39;</span></span>
<span id="cb1-81"><a href="#cb1-81"></a><span class="co">#&gt; The following objects are masked from &#39;package:purrr&#39;:</span></span>
<span id="cb1-82"><a href="#cb1-82"></a><span class="co">#&gt; </span></span>
<span id="cb1-83"><a href="#cb1-83"></a><span class="co">#&gt;     compose, simplify</span></span>
<span id="cb1-84"><a href="#cb1-84"></a><span class="co">#&gt; The following object is masked from &#39;package:flowCore&#39;:</span></span>
<span id="cb1-85"><a href="#cb1-85"></a><span class="co">#&gt; </span></span>
<span id="cb1-86"><a href="#cb1-86"></a><span class="co">#&gt;     normalize</span></span>
<span id="cb1-87"><a href="#cb1-87"></a><span class="co">#&gt; The following objects are masked from &#39;package:DelayedArray&#39;:</span></span>
<span id="cb1-88"><a href="#cb1-88"></a><span class="co">#&gt; </span></span>
<span id="cb1-89"><a href="#cb1-89"></a><span class="co">#&gt;     path, simplify</span></span>
<span id="cb1-90"><a href="#cb1-90"></a><span class="co">#&gt; The following object is masked from &#39;package:GenomicRanges&#39;:</span></span>
<span id="cb1-91"><a href="#cb1-91"></a><span class="co">#&gt; </span></span>
<span id="cb1-92"><a href="#cb1-92"></a><span class="co">#&gt;     union</span></span>
<span id="cb1-93"><a href="#cb1-93"></a><span class="co">#&gt; The following object is masked from &#39;package:IRanges&#39;:</span></span>
<span id="cb1-94"><a href="#cb1-94"></a><span class="co">#&gt; </span></span>
<span id="cb1-95"><a href="#cb1-95"></a><span class="co">#&gt;     union</span></span>
<span id="cb1-96"><a href="#cb1-96"></a><span class="co">#&gt; The following object is masked from &#39;package:S4Vectors&#39;:</span></span>
<span id="cb1-97"><a href="#cb1-97"></a><span class="co">#&gt; </span></span>
<span id="cb1-98"><a href="#cb1-98"></a><span class="co">#&gt;     union</span></span>
<span id="cb1-99"><a href="#cb1-99"></a><span class="co">#&gt; The following objects are masked from &#39;package:BiocGenerics&#39;:</span></span>
<span id="cb1-100"><a href="#cb1-100"></a><span class="co">#&gt; </span></span>
<span id="cb1-101"><a href="#cb1-101"></a><span class="co">#&gt;     normalize, path, union</span></span>
<span id="cb1-102"><a href="#cb1-102"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb1-103"><a href="#cb1-103"></a><span class="co">#&gt; </span></span>
<span id="cb1-104"><a href="#cb1-104"></a><span class="co">#&gt;     decompose, spectrum</span></span>
<span id="cb1-105"><a href="#cb1-105"></a><span class="co">#&gt; The following object is masked from &#39;package:base&#39;:</span></span>
<span id="cb1-106"><a href="#cb1-106"></a><span class="co">#&gt; </span></span>
<span id="cb1-107"><a href="#cb1-107"></a><span class="co">#&gt;     union</span></span>
<span id="cb1-108"><a href="#cb1-108"></a><span class="kw">library</span>(SummarizedExperiment)</span>
<span id="cb1-109"><a href="#cb1-109"></a><span class="kw">library</span>(ConsensusClusterPlus)</span>
<span id="cb1-110"><a href="#cb1-110"></a><span class="kw">library</span>(SingleCellExperiment)</span>
<span id="cb1-111"><a href="#cb1-111"></a><span class="kw">library</span>(shiny)</span>
<span id="cb1-112"><a href="#cb1-112"></a><span class="kw">library</span>(shinyjs)</span>
<span id="cb1-113"><a href="#cb1-113"></a><span class="co">#&gt; </span></span>
<span id="cb1-114"><a href="#cb1-114"></a><span class="co">#&gt; Attaching package: &#39;shinyjs&#39;</span></span>
<span id="cb1-115"><a href="#cb1-115"></a><span class="co">#&gt; The following object is masked from &#39;package:shiny&#39;:</span></span>
<span id="cb1-116"><a href="#cb1-116"></a><span class="co">#&gt; </span></span>
<span id="cb1-117"><a href="#cb1-117"></a><span class="co">#&gt;     runExample</span></span>
<span id="cb1-118"><a href="#cb1-118"></a><span class="co">#&gt; The following object is masked from &#39;package:flowCore&#39;:</span></span>
<span id="cb1-119"><a href="#cb1-119"></a><span class="co">#&gt; </span></span>
<span id="cb1-120"><a href="#cb1-120"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-121"><a href="#cb1-121"></a><span class="co">#&gt; The following object is masked from &#39;package:SingleCellExperiment&#39;:</span></span>
<span id="cb1-122"><a href="#cb1-122"></a><span class="co">#&gt; </span></span>
<span id="cb1-123"><a href="#cb1-123"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-124"><a href="#cb1-124"></a><span class="co">#&gt; The following object is masked from &#39;package:SummarizedExperiment&#39;:</span></span>
<span id="cb1-125"><a href="#cb1-125"></a><span class="co">#&gt; </span></span>
<span id="cb1-126"><a href="#cb1-126"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-127"><a href="#cb1-127"></a><span class="co">#&gt; The following object is masked from &#39;package:DelayedArray&#39;:</span></span>
<span id="cb1-128"><a href="#cb1-128"></a><span class="co">#&gt; </span></span>
<span id="cb1-129"><a href="#cb1-129"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-130"><a href="#cb1-130"></a><span class="co">#&gt; The following object is masked from &#39;package:Biobase&#39;:</span></span>
<span id="cb1-131"><a href="#cb1-131"></a><span class="co">#&gt; </span></span>
<span id="cb1-132"><a href="#cb1-132"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-133"><a href="#cb1-133"></a><span class="co">#&gt; The following object is masked from &#39;package:GenomicRanges&#39;:</span></span>
<span id="cb1-134"><a href="#cb1-134"></a><span class="co">#&gt; </span></span>
<span id="cb1-135"><a href="#cb1-135"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-136"><a href="#cb1-136"></a><span class="co">#&gt; The following object is masked from &#39;package:GenomeInfoDb&#39;:</span></span>
<span id="cb1-137"><a href="#cb1-137"></a><span class="co">#&gt; </span></span>
<span id="cb1-138"><a href="#cb1-138"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-139"><a href="#cb1-139"></a><span class="co">#&gt; The following object is masked from &#39;package:IRanges&#39;:</span></span>
<span id="cb1-140"><a href="#cb1-140"></a><span class="co">#&gt; </span></span>
<span id="cb1-141"><a href="#cb1-141"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-142"><a href="#cb1-142"></a><span class="co">#&gt; The following object is masked from &#39;package:S4Vectors&#39;:</span></span>
<span id="cb1-143"><a href="#cb1-143"></a><span class="co">#&gt; </span></span>
<span id="cb1-144"><a href="#cb1-144"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-145"><a href="#cb1-145"></a><span class="co">#&gt; The following object is masked from &#39;package:stats4&#39;:</span></span>
<span id="cb1-146"><a href="#cb1-146"></a><span class="co">#&gt; </span></span>
<span id="cb1-147"><a href="#cb1-147"></a><span class="co">#&gt;     show</span></span>
<span id="cb1-148"><a href="#cb1-148"></a><span class="co">#&gt; The following objects are masked from &#39;package:methods&#39;:</span></span>
<span id="cb1-149"><a href="#cb1-149"></a><span class="co">#&gt; </span></span>
<span id="cb1-150"><a href="#cb1-150"></a><span class="co">#&gt;     removeClass, show</span></span>
<span id="cb1-151"><a href="#cb1-151"></a><span class="kw">library</span>(shinydashboard)</span>
<span id="cb1-152"><a href="#cb1-152"></a><span class="co">#&gt; </span></span>
<span id="cb1-153"><a href="#cb1-153"></a><span class="co">#&gt; Attaching package: &#39;shinydashboard&#39;</span></span>
<span id="cb1-154"><a href="#cb1-154"></a><span class="co">#&gt; The following object is masked from &#39;package:graphics&#39;:</span></span>
<span id="cb1-155"><a href="#cb1-155"></a><span class="co">#&gt; </span></span>
<span id="cb1-156"><a href="#cb1-156"></a><span class="co">#&gt;     box</span></span>
<span id="cb1-157"><a href="#cb1-157"></a><span class="kw">library</span>(writexl)</span>
<span id="cb1-158"><a href="#cb1-158"></a><span class="kw">library</span>(ComplexHeatmap)</span>
<span id="cb1-159"><a href="#cb1-159"></a><span class="co">#&gt; Loading required package: grid</span></span>
<span id="cb1-160"><a href="#cb1-160"></a><span class="co">#&gt; ========================================</span></span>
<span id="cb1-161"><a href="#cb1-161"></a><span class="co">#&gt; ComplexHeatmap version 2.4.3</span></span>
<span id="cb1-162"><a href="#cb1-162"></a><span class="co">#&gt; Bioconductor page: http://bioconductor.org/packages/ComplexHeatmap/</span></span>
<span id="cb1-163"><a href="#cb1-163"></a><span class="co">#&gt; Github page: https://github.com/jokergoo/ComplexHeatmap</span></span>
<span id="cb1-164"><a href="#cb1-164"></a><span class="co">#&gt; Documentation: http://jokergoo.github.io/ComplexHeatmap-reference</span></span>
<span id="cb1-165"><a href="#cb1-165"></a><span class="co">#&gt; </span></span>
<span id="cb1-166"><a href="#cb1-166"></a><span class="co">#&gt; If you use it in published research, please cite:</span></span>
<span id="cb1-167"><a href="#cb1-167"></a><span class="co">#&gt; Gu, Z. Complex heatmaps reveal patterns and correlations in multidimensional </span></span>
<span id="cb1-168"><a href="#cb1-168"></a><span class="co">#&gt;   genomic data. Bioinformatics 2016.</span></span>
<span id="cb1-169"><a href="#cb1-169"></a><span class="co">#&gt; </span></span>
<span id="cb1-170"><a href="#cb1-170"></a><span class="co">#&gt; This message can be suppressed by:</span></span>
<span id="cb1-171"><a href="#cb1-171"></a><span class="co">#&gt;   suppressPackageStartupMessages(library(ComplexHeatmap))</span></span>
<span id="cb1-172"><a href="#cb1-172"></a><span class="co">#&gt; ========================================</span></span>
<span id="cb1-173"><a href="#cb1-173"></a><span class="kw">library</span>(shinycssloaders)</span></code></pre></div>
</div>
<div id="dataset" class="section level2">
<h2>Dataset</h2>
<p>Users are required to provide: the path to the fcs files from all the samples in the study, a metadata file containing the details of each sample and their respective .fcs files, and a panel file containing the details of all proteins used in the study. The metadata file is an excel file with the following column names: “file_name”, “sample_id”, “condition”, “patient_id”, “batch”. The panel file is an excel file with the following column names: “fcs_colname”, “antigen”, “marker_class”.</p>
<p>We provided an example dataset to help you prepare your data. The command below will load all the dataset including the metadata file, the panel file and the fcs files in the working directory.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>  output_dir=<span class="st">&quot;CytofRUV_output&quot;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(output_dir)){</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="kw">dir.create</span>(output_dir)</span>
<span id="cb2-4"><a href="#cb2-4"></a>  }</span>
<span id="cb2-5"><a href="#cb2-5"></a>  wd_data=<span class="kw">file.path</span>(<span class="kw">getwd</span>(),output_dir)</span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="kw">write.FCS</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>A1,<span class="dt">filename =</span><span class="kw">file.path</span>(wd_data,<span class="st">&quot;A1.fcs&quot;</span>))</span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">#&gt; [1] &quot;/stornext/Home/data/allstaff/l/leong.l/CytofRUV/vignettes/CytofRUV_output/A1.fcs&quot;</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="kw">write.FCS</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>A2,<span class="dt">filename =</span> <span class="kw">file.path</span>(wd_data,<span class="st">&quot;A2.fcs&quot;</span>))</span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">#&gt; [1] &quot;/stornext/Home/data/allstaff/l/leong.l/CytofRUV/vignettes/CytofRUV_output/A2.fcs&quot;</span></span>
<span id="cb2-10"><a href="#cb2-10"></a>  <span class="kw">write.FCS</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>Run3_A1,<span class="dt">filename =</span> <span class="kw">file.path</span>(wd_data,<span class="st">&quot;Run3_A1.fcs&quot;</span>))</span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">#&gt; [1] &quot;/stornext/Home/data/allstaff/l/leong.l/CytofRUV/vignettes/CytofRUV_output/Run3_A1.fcs&quot;</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>  <span class="kw">write.FCS</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>Run3_A2,<span class="dt">filename =</span> <span class="kw">file.path</span>(wd_data,<span class="st">&quot;Run3_A2.fcs&quot;</span>))</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt; [1] &quot;/stornext/Home/data/allstaff/l/leong.l/CytofRUV/vignettes/CytofRUV_output/Run3_A2.fcs&quot;</span></span>
<span id="cb2-14"><a href="#cb2-14"></a>  <span class="kw">write_xlsx</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>md,<span class="dt">path =</span> <span class="kw">file.path</span>(wd_data,<span class="st">&quot;Metadata.xlsx&quot;</span>))</span>
<span id="cb2-15"><a href="#cb2-15"></a>  <span class="kw">write_xlsx</span>(<span class="dt">x=</span>CytofRUV<span class="op">::</span>panel,<span class="dt">path =</span> <span class="kw">file.path</span>(wd_data,<span class="st">&quot;Panel.xlsx&quot;</span>))</span></code></pre></div>
</div>
<div id="loading-datasets-and-clustering" class="section level2">
<h2>Loading datasets and clustering</h2>
<p>The first step is to load the metadata file, all the .fcs files, the panel file from the dataset. The user needs to define the working directory as well as the filename of the metadata file and the panel file. Once the dataset is loaded, after applying an arcsinh transformation (cofactor 5), all the data will be clustered. The user needs to provide the number of clusters to be used for this dataset.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>  <span class="co">## Define parameters to load and cluster the data</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>  output_dir=<span class="st">&quot;CytofRUV_output&quot;</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="cf">if</span> (<span class="op">!</span><span class="kw">dir.exists</span>(output_dir)){</span>
<span id="cb3-4"><a href="#cb3-4"></a>    <span class="kw">dir.create</span>(output_dir)</span>
<span id="cb3-5"><a href="#cb3-5"></a>  }</span>
<span id="cb3-6"><a href="#cb3-6"></a>  wd_data=<span class="kw">file.path</span>(<span class="kw">getwd</span>(),output_dir)</span>
<span id="cb3-7"><a href="#cb3-7"></a>  metadata_filename=<span class="st">&quot;Metadata.xlsx&quot;</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>  panel_filename=<span class="st">&quot;Panel.xlsx&quot;</span></span>
<span id="cb3-9"><a href="#cb3-9"></a>  seed=<span class="dv">1234</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>  clusters_nb=<span class="dv">20</span></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a>  <span class="co">## Loading the data</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>  data=<span class="kw">load_data</span>(wd_data,metadata_filename,panel_filename)</span>
<span id="cb3-14"><a href="#cb3-14"></a><span class="co">#&gt; [1] &quot;Reading MetaData&quot;</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="co">#&gt; [1] &quot;Reading fcs files&quot;</span></span>
<span id="cb3-16"><a href="#cb3-16"></a><span class="co">#&gt;              name             desc    range minRange maxRange</span></span>
<span id="cb3-17"><a href="#cb3-17"></a><span class="co">#&gt; $P1          Time             &lt;NA&gt; 15248628        0 15248627</span></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">#&gt; $P2  Event_length             &lt;NA&gt;       94        0       93</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="co">#&gt; $P3         Y89Di         89Y_CD45     2410        0     2409</span></span>
<span id="cb3-20"><a href="#cb3-20"></a><span class="co">#&gt; $P4       Pd102Di    102Pd_Barcode    20694        0    20693</span></span>
<span id="cb3-21"><a href="#cb3-21"></a><span class="co">#&gt; $P5       Pd104Di    104Pd_Barcode    24736        0    24735</span></span>
<span id="cb3-22"><a href="#cb3-22"></a><span class="co">#&gt; $P6       Pd105Di    105Pd_Barcode    24619        0    24618</span></span>
<span id="cb3-23"><a href="#cb3-23"></a><span class="co">#&gt; $P7       Pd106Di    106Pd_Barcode    20195        0    20194</span></span>
<span id="cb3-24"><a href="#cb3-24"></a><span class="co">#&gt; $P8       Pd108Di    108Pd_Barcode    23303        0    23302</span></span>
<span id="cb3-25"><a href="#cb3-25"></a><span class="co">#&gt; $P9       Pd110Di    110Pd_Barcode    20908        0    20907</span></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">#&gt; $P10      In115Di     115In_HLA-DR     4659        0     4658</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">#&gt; $P11      La139Di            139La    17653        0    17652</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">#&gt; $P12      Ce140Di 140Ce_CD27_MT271    23401        0    23400</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="co">#&gt; $P13      Pr141Di    141Pr_CD235ab    20716        0    20715</span></span>
<span id="cb3-30"><a href="#cb3-30"></a><span class="co">#&gt; $P14      Nd142Di       142Nd_CD19    12575        0    12574</span></span>
<span id="cb3-31"><a href="#cb3-31"></a><span class="co">#&gt; $P15      Nd143Di        143Nd_CD5    13286        0    13285</span></span>
<span id="cb3-32"><a href="#cb3-32"></a><span class="co">#&gt; $P16      Nd144Di       144Nd_CD38     4375        0     4374</span></span>
<span id="cb3-33"><a href="#cb3-33"></a><span class="co">#&gt; $P17      Nd145Di        145Nd_CD4     1661        0     1660</span></span>
<span id="cb3-34"><a href="#cb3-34"></a><span class="co">#&gt; $P18      Nd146Di        146Nd_CD8     3366        0     3365</span></span>
<span id="cb3-35"><a href="#cb3-35"></a><span class="co">#&gt; $P19      Sm147Di       147Sm_CD20    14397        0    14396</span></span>
<span id="cb3-36"><a href="#cb3-36"></a><span class="co">#&gt; $P20      Nd148Di       148Nd_CD16     2340        0     2339</span></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">#&gt; $P21      Eu151Di      151Eu_CD123    14973        0    14972</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="co">#&gt; $P22      Eu153Di     153Eu_Bcl-xL    37056        0    37055</span></span>
<span id="cb3-39"><a href="#cb3-39"></a><span class="co">#&gt; $P23      Sm154Di    154Sm_Bax_1B4     8837        0     8836</span></span>
<span id="cb3-40"><a href="#cb3-40"></a><span class="co">#&gt; $P24      Gd155Di       155Gd_CD56     2154        0     2153</span></span>
<span id="cb3-41"><a href="#cb3-41"></a><span class="co">#&gt; $P25      Gd156Di       156Gd_CD14    15853        0    15852</span></span>
<span id="cb3-42"><a href="#cb3-42"></a><span class="co">#&gt; $P26      Gd157Di      157Gd_Bcl-2    29777        0    29776</span></span>
<span id="cb3-43"><a href="#cb3-43"></a><span class="co">#&gt; $P27      Tb159Di      159Tb_CD11c     2290        0     2289</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="co">#&gt; $P28      Gd160Di      160Gd_Mcl-1     1252        0     1251</span></span>
<span id="cb3-45"><a href="#cb3-45"></a><span class="co">#&gt; $P29      Dy161Di       161Dy_cMyc     3241        0     3240</span></span>
<span id="cb3-46"><a href="#cb3-46"></a><span class="co">#&gt; $P30      Dy163Di      163Dy_BFL-1    35013        0    35012</span></span>
<span id="cb3-47"><a href="#cb3-47"></a><span class="co">#&gt; $P31      Ho165Di        165Ho_Bim    28808        0    28807</span></span>
<span id="cb3-48"><a href="#cb3-48"></a><span class="co">#&gt; $P32      Er166Di        166Er_pRb     1595        0     1594</span></span>
<span id="cb3-49"><a href="#cb3-49"></a><span class="co">#&gt; $P33      Er167Di       167Er_CD27      715        0      714</span></span>
<span id="cb3-50"><a href="#cb3-50"></a><span class="co">#&gt; $P34      Er168Di       168Er_PUMA    17910        0    17909</span></span>
<span id="cb3-51"><a href="#cb3-51"></a><span class="co">#&gt; $P35      Tm169Di     169Tm_CD45RA     5446        0     5445</span></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="co">#&gt; $P36      Er170Di        170Er_CD3    13066        0    13065</span></span>
<span id="cb3-53"><a href="#cb3-53"></a><span class="co">#&gt; $P37      Yb171Di       171Yb_CD66     6918        0     6917</span></span>
<span id="cb3-54"><a href="#cb3-54"></a><span class="co">#&gt; $P38      Yb172Di      172Yb_BCL-W    32300        0    32299</span></span>
<span id="cb3-55"><a href="#cb3-55"></a><span class="co">#&gt; $P39      Yb173Di  173Yb_cCaspase3    10011        0    10010</span></span>
<span id="cb3-56"><a href="#cb3-56"></a><span class="co">#&gt; $P40      Yb174Di        174Yb_p53     3874        0     3873</span></span>
<span id="cb3-57"><a href="#cb3-57"></a><span class="co">#&gt; $P41      Ir191Di       191Ir_DNA1    31341        0    31340</span></span>
<span id="cb3-58"><a href="#cb3-58"></a><span class="co">#&gt; $P42      Ir193Di       193Ir_DNA2    39168        0    39167</span></span>
<span id="cb3-59"><a href="#cb3-59"></a><span class="co">#&gt; $P43      Pt194Di  194Pt_Cisplatin    37287        0    37286</span></span>
<span id="cb3-60"><a href="#cb3-60"></a><span class="co">#&gt; $P44      Pt195Di  195Pt_Cisplatin    37573        0    37572</span></span>
<span id="cb3-61"><a href="#cb3-61"></a><span class="co">#&gt; $P45      Bi209Di       209Bi_CD61    58960        0    58959</span></span>
<span id="cb3-62"><a href="#cb3-62"></a><span class="co">#&gt; $P46       Center             &lt;NA&gt;     6732        0     6731</span></span>
<span id="cb3-63"><a href="#cb3-63"></a><span class="co">#&gt; $P47       Offset             &lt;NA&gt;      670        0      669</span></span>
<span id="cb3-64"><a href="#cb3-64"></a><span class="co">#&gt; $P48        Width             &lt;NA&gt;      325        0      324</span></span>
<span id="cb3-65"><a href="#cb3-65"></a><span class="co">#&gt; $P49     Residual             &lt;NA&gt;      846        0      845</span></span>
<span id="cb3-66"><a href="#cb3-66"></a><span class="co">#&gt; [1] &quot;Read Panel File&quot;</span></span>
<span id="cb3-67"><a href="#cb3-67"></a><span class="co">#&gt; [1] &quot;Checking panel colNames&quot;</span></span>
<span id="cb3-68"><a href="#cb3-68"></a><span class="co">#&gt; [1] &quot;Checking panel values&quot;</span></span>
<span id="cb3-69"><a href="#cb3-69"></a><span class="co">#&gt;  [1] &quot;Eu153Di&quot; &quot;Sm154Di&quot; &quot;Gd157Di&quot; &quot;Gd160Di&quot; &quot;Dy161Di&quot; &quot;Dy163Di&quot; &quot;Ho165Di&quot;</span></span>
<span id="cb3-70"><a href="#cb3-70"></a><span class="co">#&gt;  [8] &quot;Er166Di&quot; &quot;Er168Di&quot; &quot;Yb172Di&quot; &quot;Yb173Di&quot; &quot;Yb174Di&quot; &quot;Y89Di&quot;   &quot;In115Di&quot;</span></span>
<span id="cb3-71"><a href="#cb3-71"></a><span class="co">#&gt; [15] &quot;Pr141Di&quot; &quot;Nd142Di&quot; &quot;Nd143Di&quot; &quot;Nd144Di&quot; &quot;Nd145Di&quot; &quot;Nd146Di&quot; &quot;Sm147Di&quot;</span></span>
<span id="cb3-72"><a href="#cb3-72"></a><span class="co">#&gt; [22] &quot;Nd148Di&quot; &quot;Eu151Di&quot; &quot;Gd155Di&quot; &quot;Gd156Di&quot; &quot;Tb159Di&quot; &quot;Er167Di&quot; &quot;Tm169Di&quot;</span></span>
<span id="cb3-73"><a href="#cb3-73"></a><span class="co">#&gt; [29] &quot;Er170Di&quot; &quot;Yb171Di&quot; &quot;Bi209Di&quot;</span></span>
<span id="cb3-74"><a href="#cb3-74"></a><span class="co">#&gt; NULL</span></span>
<span id="cb3-75"><a href="#cb3-75"></a><span class="co">#&gt; [1] &quot;Formatting Data&quot;</span></span>
<span id="cb3-76"><a href="#cb3-76"></a><span class="co">#&gt; [1] &quot;Completed creating DaFrame Objects&quot;</span></span>
<span id="cb3-77"><a href="#cb3-77"></a></span>
<span id="cb3-78"><a href="#cb3-78"></a>  <span class="co">## Cluster the data</span></span>
<span id="cb3-79"><a href="#cb3-79"></a>  data<span class="op">$</span>daf=<span class="kw">cluster_data</span>(data<span class="op">$</span>daf,seed,<span class="dt">markers_to_use=</span>data<span class="op">$</span>lineage_markers,clusters_nb)</span>
<span id="cb3-80"><a href="#cb3-80"></a><span class="co">#&gt; o running FlowSOM clustering...</span></span>
<span id="cb3-81"><a href="#cb3-81"></a><span class="co">#&gt; o running ConsensusClusterPlus metaclustering...</span></span></code></pre></div>
</div>
<div id="r-shiny-interface-before-cytofruv-normalisation" class="section level2">
<h2>R-Shiny interface before CytofRUV normalisation</h2>
<p>To examine the batch effects found when comparing CyTOF data from samples replicated across batches, we built an R-Shiny application that exhibits any batch effects present in samples replicated across batches using four different diagnostics plots: Median Protein Expression, Protein Expression Distributions, Clustering Results and Cluster Proportions.</p>
<p>The user needs to select the data to use (before or after normalisation) to visualise the diagnostic plots using the R-Shiny interface. The user can choose to visualise all the data or only a subset of the data which might be advisable for exploratory analysis.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>  <span class="co">## Define parameters to use for R-Shiny</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  daf=data<span class="op">$</span>daf</span>
<span id="cb4-3"><a href="#cb4-3"></a>  md=data<span class="op">$</span>md</span>
<span id="cb4-4"><a href="#cb4-4"></a>  seed=<span class="dv">1234</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="co"># Number of cells displayed for the Distribution of protein expression plot</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  n_subset_marker_specific &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>  </span>
<span id="cb4-8"><a href="#cb4-8"></a>  <span class="co"># Running Dimension Reduction -&gt; TSNE &amp; UMAP</span></span>
<span id="cb4-9"><a href="#cb4-9"></a>  <span class="kw">set.seed</span>(seed)</span>
<span id="cb4-10"><a href="#cb4-10"></a>  </span>
<span id="cb4-11"><a href="#cb4-11"></a>  <span class="co"># Number of cells for tSNE plots marker specific</span></span>
<span id="cb4-12"><a href="#cb4-12"></a>  TSNE_subset &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>  <span class="kw">print</span>(<span class="st">&quot;Running TSNE&quot;</span>)</span>
<span id="cb4-14"><a href="#cb4-14"></a>  daf &lt;-<span class="st"> </span>CATALYST<span class="op">::</span><span class="kw">runDR</span>(daf, <span class="dt">dr =</span> <span class="st">&quot;TSNE&quot;</span>, <span class="dt">cells =</span> TSNE_subset)</span>
<span id="cb4-15"><a href="#cb4-15"></a>  </span>
<span id="cb4-16"><a href="#cb4-16"></a>  <span class="co"># Number of cells for UMAP plots marker specific</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>  UMAP_subset &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="kw">print</span>(<span class="st">&quot;Running UMAP&quot;</span>)</span>
<span id="cb4-19"><a href="#cb4-19"></a>  daf &lt;-<span class="st"> </span><span class="kw">runDR</span>(daf, <span class="st">&quot;UMAP&quot;</span>, <span class="dt">cells =</span> UMAP_subset)</span>
<span id="cb4-20"><a href="#cb4-20"></a>  </span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="co">## Launch Shiny</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>  <span class="co"># For a subset of the data, define the number of cells for diagnostic plots</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>  n_subset &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb4-24"><a href="#cb4-24"></a>  sub_daf &lt;-<span class="st"> </span>daf[, <span class="kw">sample</span>(<span class="kw">ncol</span>(daf), n_subset)]</span>
<span id="cb4-25"><a href="#cb4-25"></a>  </span>
<span id="cb4-26"><a href="#cb4-26"></a>  <span class="co">## For the full dataset: </span></span>
<span id="cb4-27"><a href="#cb4-27"></a>  <span class="co"># sub_daf &lt;- daf</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>  </span>
<span id="cb4-29"><a href="#cb4-29"></a>  panel=data<span class="op">$</span>panel</span>
<span id="cb4-30"><a href="#cb4-30"></a>  </span>
<span id="cb4-31"><a href="#cb4-31"></a>  CytofRUV<span class="op">::</span><span class="kw">launch_Shiny</span>()</span></code></pre></div>
</div>
<div id="cytofruv-normalisation-procedure" class="section level2">
<h2>CytofRUV normalisation procedure</h2>
<p>TThe normalize_data function allow the user to adjust for batch effects with parameter settings for the CytofRUV algorithm, such as which replicated samples to use and the value of k. The user can specify below the name of the directory to save the normalised data (dir_name_norm_data) or use the get_directory function which will ask the user to specify the directory. The normalised files and the metadata and panel files will be save into the specified directory.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co">#dir_name_norm_data = get_directory()</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>dir_name_norm_data=<span class="st">&quot;CytofRUV_Norm_data_HC2_all_cl_20&quot;</span></span>
<span id="cb5-3"><a href="#cb5-3"></a>raw_data &lt;-<span class="st"> </span><span class="kw">data.frame</span>(<span class="dt">sample =</span> data<span class="op">$</span>daf<span class="op">$</span>sample_id, <span class="dt">cluster=</span><span class="kw">cluster_ids</span>(data<span class="op">$</span>daf,<span class="st">&quot;meta20&quot;</span>), <span class="kw">t</span>(SummarizedExperiment<span class="op">::</span><span class="kw">assay</span>(data<span class="op">$</span>daf,<span class="st">&quot;exprs&quot;</span>)))</span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">colnames</span>(raw_data) &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&quot;^X&quot;</span>, <span class="st">&quot;&quot;</span>,  <span class="kw">colnames</span>(raw_data))</span>
<span id="cb5-5"><a href="#cb5-5"></a>rep_samples=<span class="kw">list</span>(<span class="kw">c</span>(<span class="st">&quot;HC2_B1&quot;</span>,<span class="st">&quot;HC2_B2&quot;</span>))</span>
<span id="cb5-6"><a href="#cb5-6"></a>cluster_list_rep_samples &lt;-<span class="st"> </span><span class="kw">list</span>(<span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">20</span>))</span>
<span id="cb5-7"><a href="#cb5-7"></a>k_value &lt;-<span class="st"> </span><span class="dv">5</span></span>
<span id="cb5-8"><a href="#cb5-8"></a>seed=<span class="dv">1234</span></span>
<span id="cb5-9"><a href="#cb5-9"></a></span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="kw">normalise_data</span>(<span class="dt">data=</span>data,<span class="dt">raw_data=</span>raw_data,<span class="dt">rep_samples=</span>rep_samples, <span class="dt">norm_clusters=</span>cluster_list_rep_samples, <span class="dt">k=</span>k_value, <span class="dt">num_clusters=</span>clusters_nb,<span class="dt">wd_data=</span>wd_data,<span class="dt">dir_norm_data=</span>dir_name_norm_data)</span></code></pre></div>
</div>
<div id="loading-and-clustering-the-data-after-cytofruv-normalisation" class="section level2">
<h2>Loading and clustering the data after CytofRUV normalisation</h2>
<p>The first step is to load the metadata file, all the .fcs files, the panel file from the dataset. The user needs to define the working directory as well as the filename of the metadata file and the panel file. Once the dataset is loaded, after applying an arcsinh transformation (cofactor 5), all the data will be clustered. The user needs to provide the number of clusters to be used for this dataset.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a>  <span class="co">## Define parameters to load and cluster the data</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  wd_norm=<span class="kw">file.path</span>(wd_data,dir_name_norm_data)</span>
<span id="cb6-3"><a href="#cb6-3"></a>  metadata_norm_filename=<span class="st">&quot;Norm_Metadata.xlsx&quot;</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  panel_norm_filename=<span class="st">&quot;Norm_Panel.xlsx&quot;</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  seed=<span class="dv">1234</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  clusters_nb=<span class="dv">20</span></span>
<span id="cb6-7"><a href="#cb6-7"></a></span>
<span id="cb6-8"><a href="#cb6-8"></a>  <span class="co">## Loading the data</span></span>
<span id="cb6-9"><a href="#cb6-9"></a>  norm_data=<span class="kw">load_data</span>(wd_norm,metadata_norm_filename,panel_norm_filename,<span class="dt">cofactor =</span> <span class="ot">NULL</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a><span class="co">#&gt; [1] &quot;Reading MetaData&quot;</span></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co">#&gt; [1] &quot;Reading fcs files&quot;</span></span>
<span id="cb6-12"><a href="#cb6-12"></a><span class="co">#&gt;         name            desc    range   minRange maxRange</span></span>
<span id="cb6-13"><a href="#cb6-13"></a><span class="co">#&gt; $P1     Time            &lt;NA&gt; 15248628  0.0000000 15248627</span></span>
<span id="cb6-14"><a href="#cb6-14"></a><span class="co">#&gt; $P2    Y89Di        89Y_CD45     2410 -0.4510004     2409</span></span>
<span id="cb6-15"><a href="#cb6-15"></a><span class="co">#&gt; $P3  In115Di    115In_HLA-DR     4659 -1.1074120     4658</span></span>
<span id="cb6-16"><a href="#cb6-16"></a><span class="co">#&gt; $P4  Pr141Di   141Pr_CD235ab    20716 -3.3255489    20693</span></span>
<span id="cb6-17"><a href="#cb6-17"></a><span class="co">#&gt; $P5  Nd142Di      142Nd_CD19    12575 -1.1849808    24735</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="co">#&gt; $P6  Nd143Di       143Nd_CD5    13286 -1.1990349    24618</span></span>
<span id="cb6-19"><a href="#cb6-19"></a><span class="co">#&gt; $P7  Nd144Di      144Nd_CD38     4375 -2.5586534    20194</span></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="co">#&gt; $P8  Nd145Di       145Nd_CD4     1661 -3.2051425    23302</span></span>
<span id="cb6-21"><a href="#cb6-21"></a><span class="co">#&gt; $P9  Nd146Di       146Nd_CD8     3366 -2.4574041    20907</span></span>
<span id="cb6-22"><a href="#cb6-22"></a><span class="co">#&gt; $P10 Sm147Di      147Sm_CD20    14397 -0.6710566    14396</span></span>
<span id="cb6-23"><a href="#cb6-23"></a><span class="co">#&gt; $P11 Nd148Di      148Nd_CD16     2340 -1.4539309     2339</span></span>
<span id="cb6-24"><a href="#cb6-24"></a><span class="co">#&gt; $P12 Eu151Di     151Eu_CD123    14973 -1.2618363    14972</span></span>
<span id="cb6-25"><a href="#cb6-25"></a><span class="co">#&gt; $P13 Gd155Di      155Gd_CD56     2154 -2.2674949     2153</span></span>
<span id="cb6-26"><a href="#cb6-26"></a><span class="co">#&gt; $P14 Gd156Di      156Gd_CD14    15853 -1.9339695    15852</span></span>
<span id="cb6-27"><a href="#cb6-27"></a><span class="co">#&gt; $P15 Tb159Di     159Tb_CD11c     2290 -1.7672182     2289</span></span>
<span id="cb6-28"><a href="#cb6-28"></a><span class="co">#&gt; $P16 Er167Di      167Er_CD27      715 -1.2433747      714</span></span>
<span id="cb6-29"><a href="#cb6-29"></a><span class="co">#&gt; $P17 Tm169Di    169Tm_CD45RA     5446 -3.0584748     5445</span></span>
<span id="cb6-30"><a href="#cb6-30"></a><span class="co">#&gt; $P18 Er170Di       170Er_CD3    13066 -2.4981380    13065</span></span>
<span id="cb6-31"><a href="#cb6-31"></a><span class="co">#&gt; $P19 Yb171Di      171Yb_CD66     6918 -1.4444346     6917</span></span>
<span id="cb6-32"><a href="#cb6-32"></a><span class="co">#&gt; $P20 Bi209Di      209Bi_CD61    58960 -3.0733371    58959</span></span>
<span id="cb6-33"><a href="#cb6-33"></a><span class="co">#&gt; $P21 Eu153Di    153Eu_Bcl-xL    37056 -3.4634755    37055</span></span>
<span id="cb6-34"><a href="#cb6-34"></a><span class="co">#&gt; $P22 Sm154Di   154Sm_Bax_1B4     8837 -2.8547149     8836</span></span>
<span id="cb6-35"><a href="#cb6-35"></a><span class="co">#&gt; $P23 Gd157Di     157Gd_Bcl-2    29777 -2.8946040    29776</span></span>
<span id="cb6-36"><a href="#cb6-36"></a><span class="co">#&gt; $P24 Gd160Di     160Gd_Mcl-1     1252 -1.4401959     1251</span></span>
<span id="cb6-37"><a href="#cb6-37"></a><span class="co">#&gt; $P25 Dy161Di      161Dy_cMyc     3241 -4.6729655     3240</span></span>
<span id="cb6-38"><a href="#cb6-38"></a><span class="co">#&gt; $P26 Dy163Di     163Dy_BFL-1    35013 -0.2315303    35012</span></span>
<span id="cb6-39"><a href="#cb6-39"></a><span class="co">#&gt; $P27 Ho165Di       165Ho_Bim    28808 -0.9914662    28807</span></span>
<span id="cb6-40"><a href="#cb6-40"></a><span class="co">#&gt; $P28 Er166Di       166Er_pRb     1595 -2.5360601     1594</span></span>
<span id="cb6-41"><a href="#cb6-41"></a><span class="co">#&gt; $P29 Er168Di      168Er_PUMA    17910 -5.2390504    17909</span></span>
<span id="cb6-42"><a href="#cb6-42"></a><span class="co">#&gt; $P30 Yb172Di     172Yb_BCL-W    32300 -0.7381380    32299</span></span>
<span id="cb6-43"><a href="#cb6-43"></a><span class="co">#&gt; $P31 Yb173Di 173Yb_cCaspase3    10011 -2.3261936    10010</span></span>
<span id="cb6-44"><a href="#cb6-44"></a><span class="co">#&gt; $P32 Yb174Di       174Yb_p53     3874 -0.8569174     3873</span></span>
<span id="cb6-45"><a href="#cb6-45"></a><span class="co">#&gt; [1] &quot;Read Panel File&quot;</span></span>
<span id="cb6-46"><a href="#cb6-46"></a><span class="co">#&gt; [1] &quot;Checking panel colNames&quot;</span></span>
<span id="cb6-47"><a href="#cb6-47"></a><span class="co">#&gt; [1] &quot;Checking panel values&quot;</span></span>
<span id="cb6-48"><a href="#cb6-48"></a><span class="co">#&gt;  [1] &quot;Eu153Di&quot; &quot;Sm154Di&quot; &quot;Gd157Di&quot; &quot;Gd160Di&quot; &quot;Dy161Di&quot; &quot;Dy163Di&quot; &quot;Ho165Di&quot;</span></span>
<span id="cb6-49"><a href="#cb6-49"></a><span class="co">#&gt;  [8] &quot;Er166Di&quot; &quot;Er168Di&quot; &quot;Yb172Di&quot; &quot;Yb173Di&quot; &quot;Yb174Di&quot; &quot;Y89Di&quot;   &quot;In115Di&quot;</span></span>
<span id="cb6-50"><a href="#cb6-50"></a><span class="co">#&gt; [15] &quot;Pr141Di&quot; &quot;Nd142Di&quot; &quot;Nd143Di&quot; &quot;Nd144Di&quot; &quot;Nd145Di&quot; &quot;Nd146Di&quot; &quot;Sm147Di&quot;</span></span>
<span id="cb6-51"><a href="#cb6-51"></a><span class="co">#&gt; [22] &quot;Nd148Di&quot; &quot;Eu151Di&quot; &quot;Gd155Di&quot; &quot;Gd156Di&quot; &quot;Tb159Di&quot; &quot;Er167Di&quot; &quot;Tm169Di&quot;</span></span>
<span id="cb6-52"><a href="#cb6-52"></a><span class="co">#&gt; [29] &quot;Er170Di&quot; &quot;Yb171Di&quot; &quot;Bi209Di&quot;</span></span>
<span id="cb6-53"><a href="#cb6-53"></a><span class="co">#&gt; NULL</span></span>
<span id="cb6-54"><a href="#cb6-54"></a><span class="co">#&gt; [1] &quot;Formatting Data&quot;</span></span>
<span id="cb6-55"><a href="#cb6-55"></a><span class="co">#&gt; [1] &quot;Completed creating DaFrame Objects&quot;</span></span>
<span id="cb6-56"><a href="#cb6-56"></a></span>
<span id="cb6-57"><a href="#cb6-57"></a>  <span class="co">## Cluster the data</span></span>
<span id="cb6-58"><a href="#cb6-58"></a>  norm_data<span class="op">$</span>daf=<span class="kw">cluster_data</span>(norm_data<span class="op">$</span>daf,seed,<span class="dt">markers_to_use=</span>norm_data<span class="op">$</span>lineage_markers,clusters_nb)</span>
<span id="cb6-59"><a href="#cb6-59"></a><span class="co">#&gt; o running FlowSOM clustering...</span></span>
<span id="cb6-60"><a href="#cb6-60"></a><span class="co">#&gt; o running ConsensusClusterPlus metaclustering...</span></span></code></pre></div>
</div>
<div id="r-shiny-interface-after-cytofruv-normalisation" class="section level2">
<h2>R-Shiny interface after CytofRUV normalisation</h2>
<p>The R-shiny interface can also be used to visualise the normalised data.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>  <span class="co">## Define parameters to use for R-Shiny</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>  daf=norm_data<span class="op">$</span>daf</span>
<span id="cb7-3"><a href="#cb7-3"></a>  md=norm_data<span class="op">$</span>md</span>
<span id="cb7-4"><a href="#cb7-4"></a>  seed=<span class="dv">1234</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="co"># Number of cells for diagnostic plots marker specific</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  n_subset_marker_specific &lt;-<span class="st"> </span><span class="dv">10000</span></span>
<span id="cb7-7"><a href="#cb7-7"></a></span>
<span id="cb7-8"><a href="#cb7-8"></a>  <span class="co"># Define type of markers</span></span>
<span id="cb7-9"><a href="#cb7-9"></a>  daf_type &lt;-<span class="st"> </span>daf[SingleCellExperiment<span class="op">::</span><span class="kw">rowData</span>(daf)<span class="op">$</span>marker_class<span class="op">==</span><span class="st">&quot;type&quot;</span>, ]</span>
<span id="cb7-10"><a href="#cb7-10"></a>  daf_state &lt;-<span class="st"> </span>daf[SingleCellExperiment<span class="op">::</span><span class="kw">rowData</span>(daf)<span class="op">$</span>marker_class<span class="op">==</span><span class="st">&quot;state&quot;</span>, ]</span>
<span id="cb7-11"><a href="#cb7-11"></a>  sub_daf_state &lt;-<span class="st"> </span>daf_state[, <span class="kw">sample</span>(<span class="kw">ncol</span>(daf_state), n_subset_marker_specific)]</span>
<span id="cb7-12"><a href="#cb7-12"></a>  sub_daf_type &lt;-<span class="st"> </span>daf_type[, <span class="kw">sample</span>(<span class="kw">ncol</span>(daf_type), n_subset_marker_specific)]</span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="co"># Define batch</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>  batch_ids &lt;-<span class="st"> </span><span class="kw">is.factor</span>(<span class="kw">rep</span>(md<span class="op">$</span>batch, <span class="kw">nrow</span>(daf)))</span>
<span id="cb7-15"><a href="#cb7-15"></a>  sampleID_sorted &lt;-<span class="st"> </span>md<span class="op">$</span>sample_id[<span class="kw">order</span>(md<span class="op">$</span>patient_id)]</span>
<span id="cb7-16"><a href="#cb7-16"></a>  </span>
<span id="cb7-17"><a href="#cb7-17"></a>  <span class="co">## Running Dimension Reduction -&gt; TSNE &amp; UMAP</span></span>
<span id="cb7-18"><a href="#cb7-18"></a>  <span class="kw">set.seed</span>(seed)</span>
<span id="cb7-19"><a href="#cb7-19"></a>  <span class="co"># Number of cells for tSNE plots marker specific</span></span>
<span id="cb7-20"><a href="#cb7-20"></a>  TSNE_subset &lt;-<span class="st"> </span><span class="dv">2000</span></span>
<span id="cb7-21"><a href="#cb7-21"></a>  <span class="kw">print</span>(<span class="st">&quot;Running TSNE&quot;</span>)</span>
<span id="cb7-22"><a href="#cb7-22"></a>  daf &lt;-<span class="st"> </span><span class="kw">runDR</span>(daf, <span class="st">&quot;TSNE&quot;</span>, <span class="dt">cells =</span> TSNE_subset)</span>
<span id="cb7-23"><a href="#cb7-23"></a>  </span>
<span id="cb7-24"><a href="#cb7-24"></a>  <span class="co"># Number of cells for UMAP plots marker specific</span></span>
<span id="cb7-25"><a href="#cb7-25"></a>  UMAP_subset &lt;-<span class="st"> </span><span class="dv">2500</span></span>
<span id="cb7-26"><a href="#cb7-26"></a>  <span class="kw">print</span>(<span class="st">&quot;Running UMAP&quot;</span>)</span>
<span id="cb7-27"><a href="#cb7-27"></a>  daf &lt;-<span class="st"> </span><span class="kw">runDR</span>(daf, <span class="st">&quot;UMAP&quot;</span>, <span class="dt">cells =</span> UMAP_subset)</span>
<span id="cb7-28"><a href="#cb7-28"></a>  </span>
<span id="cb7-29"><a href="#cb7-29"></a>  <span class="co"># Launch Shiny</span></span>
<span id="cb7-30"><a href="#cb7-30"></a>  <span class="co"># For a subset of the data, define the number of cells for diagnostic plots</span></span>
<span id="cb7-31"><a href="#cb7-31"></a>  n_subset &lt;-<span class="st"> </span><span class="dv">5000</span></span>
<span id="cb7-32"><a href="#cb7-32"></a>  sub_daf &lt;-<span class="st"> </span>daf[, <span class="kw">sample</span>(<span class="kw">ncol</span>(daf), n_subset)]</span>
<span id="cb7-33"><a href="#cb7-33"></a>  </span>
<span id="cb7-34"><a href="#cb7-34"></a>  <span class="co"># # For the full dataset: </span></span>
<span id="cb7-35"><a href="#cb7-35"></a>  <span class="co"># sub_daf &lt;- daf</span></span>
<span id="cb7-36"><a href="#cb7-36"></a>  </span>
<span id="cb7-37"><a href="#cb7-37"></a>  panel=data<span class="op">$</span>panel</span>
<span id="cb7-38"><a href="#cb7-38"></a>  </span>
<span id="cb7-39"><a href="#cb7-39"></a>  CytofRUV<span class="op">::</span><span class="kw">launch_Shiny</span>()</span></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
